{% load static %}
<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{% block title %}Módulo 1{% endblock %}</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css">
    <link rel="stylesheet" href="{% static 'css/styles.css' %}">
</head>

<body>
    <!-- Logo y Navbar -->

    <header class="bg-white shadow-sm mb-3 border-0">
        <nav class="navbar navbar-expand-lg navbar-white bg-white py-2 px-1 px-md-2 shadow-sm border-0">
            <!-- Contenedor flex para móvil -->
            <!-- Navbar móvil/tablet: visible hasta 991.98px -->
            <div class="d-flex d-lg-none w-100 align-items-center justify-content-between position-relative mobile-navbar-row">
                <div class="col-2 d-flex justify-content-start align-items-center p-0">
                    {% if request.path == '/' %}
                        <div class="btn-thumb-back inactive d-flex align-items-center justify-content-center" role="button" tabindex="0" aria-label="Volver al inicio">
                            <i class="bi bi-arrow-left"></i>
                        </div>
                    {% else %}
                        <div class="btn-thumb-back d-flex align-items-center justify-content-center" onclick="window.location='/'" role="button" tabindex="0" aria-label="Volver al inicio">
                            <i class="bi bi-arrow-left"></i>
                        </div>
                    {% endif %}
                </div>
                <div class="col-8 d-flex justify-content-center align-items-center p-0">
                    <a href="/" class="d-flex align-items-center text-decoration-none logo-navbar-mobile" style="max-width: 70vw;">
                        <i class="bi bi-grid-3x3-gap-fill fs-2 me-2 text-primary"></i>
                        <span class="fs-5 fw-bold text-dark d-none d-sm-inline">Sitio Main del servicio</span>
                    </a>
                </div>
                <div class="col-2 d-flex justify-content-end align-items-center p-0">
                    <button class="navbar-toggler border-0 shadow-none" type="button" data-bs-toggle="offcanvas" data-bs-target="#offcanvasNavbar" aria-controls="offcanvasNavbar" aria-label="Menú lateral">
                        <span class="navbar-toggler-icon"></span>
                    </button>
                </div>
            </div>
            <!-- Navbar escritorio: visible solo en PC (≥992px) -->
            <div class="container-fluid d-none d-lg-block px-1 px-md-2 position-relative">
                <div class="row align-items-center">
                    <!-- Columna 1: Logo/thumb + texto -->
                    <div class="col-auto">
                        <a href="/" class="d-flex align-items-center text-decoration-none">
                            <i class="bi bi-grid-3x3-gap-fill fs-2 me-2 text-primary"></i>
                            <span class="fs-4 fw-bold text-dark d-none d-sm-inline">Sitio Main del servicio</span>
                        </a>
                    </div>
                    <!-- Columna 2: Vacía -->
                    <div class="col"></div>
                    <!-- Columna 3: Acciones/usuario/login -->
                    <div class="col-auto">
                        <div class="d-flex align-items-center gap-3">
                            {% block nav %}{% endblock %}
                            {% if user.is_authenticated %}
                                <a href="/portal-formularios/" class="btn btn-outline-primary d-flex align-items-center px-3 py-2">
                                    <i class="bi bi-pencil-square me-2"></i>
                                    <span>Editor de formularios</span>
                                </a>
                                <div class="dropdown ms-2">
                                    <a href="#" class="btn btn-light border d-flex align-items-center dropdown-toggle px-3 py-2" id="userDropdown" data-bs-toggle="dropdown" aria-expanded="false">
                                        <i class="bi bi-person-circle me-2"></i>
                                        <span>{{ user.username }}</span>
                                    </a>
                                    <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="userDropdown">
                                        <li>
                                            <a href="/logout/" class="dropdown-item d-flex align-items-center text-primary">
                                                <i class="bi bi-box-arrow-right me-2"></i>
                                                <span>Cerrar sesión</span>
                                            </a>
                                        </li>
                                    </ul>
                                </div>
                            {% else %}
                            <div class="login-dropdown ms-2 position-relative" style="width:220px;">
                                <button type="button" class="btn login-dropdown-btn w-100 d-flex align-items-center justify-content-center" id="loginDropdown" aria-expanded="false">
                                    <i class="bi bi-box-arrow-in-right me-2"></i>
                                    <span>Iniciar sesión</span>
                                </button>
                                <div class="dropdown-menu-custom position-absolute w-100" style="top:calc(100% + 8px); left:0; display:none; z-index:1050;">
                                    <form action="/register/" method="get" class="w-100">
                                        <button type="submit" class="btn register-dropdown-btn w-100 d-flex align-items-center justify-content-center" tabindex="0">
                                            <i class="bi bi-person-plus me-2"></i>
                                            <span>Registrarse</span>
                                        </button>
                                    </form>
                                </div>
                            </div>
                            {% endif %}
                        </div>
                    </div>
                </div>
            </div>
            <!-- Offcanvas solo en móvil (sm y menores) -->
            <div class="offcanvas offcanvas-end d-block d-md-none" tabindex="-1" id="offcanvasNavbar" aria-labelledby="offcanvasNavbarLabel">
                <div class="offcanvas-header">
                    <h5 class="offcanvas-title" id="offcanvasNavbarLabel"><i class="bi bi-list"></i> Menú</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="offcanvas" aria-label="Cerrar"></button>
                </div>
                <div class="offcanvas-body">
                    <a class="nav-link px-3 py-2 text-primary fw-semibold" href="/">Inicio</a>
                    {% if user.is_authenticated %}
                        <a href="/portal-formularios/" class="btn btn-outline-primary w-100 mb-2 d-flex align-items-center justify-content-center text-center">
                            <i class="bi bi-pencil-square me-2"></i>
                            <span>Editor de formularios</span>
                        </a>
                        <div class="dropdown w-100 mb-2">
                            <a href="#" class="btn btn-light border d-flex align-items-center dropdown-toggle w-100" id="userDropdownMobile" data-bs-toggle="dropdown" aria-expanded="false">
                                <i class="bi bi-person-circle me-2"></i>
                                <span>{{ user.username }}</span>
                            </a>
                            <ul class="dropdown-menu w-100" aria-labelledby="userDropdownMobile">
                                <li>
                                    <a href="/logout/" class="dropdown-item d-flex align-items-center text-primary w-100">
                                        <i class="bi bi-box-arrow-right me-2"></i>
                                        <span>Cerrar sesión</span>
                                    </a>
                                </li>
                            </ul>
                        </div>
                    {% else %}
                        <a href="/login/" class="btn btn-primary w-100 mb-2 d-flex align-items-center justify-content-center text-center" id="loginDropdownMobile">
                            <i class="bi bi-box-arrow-in-right me-2"></i>
                            <span>Iniciar sesión</span>
                        </a>
                        <a href="/register/" class="btn btn-outline-secondary w-100 d-flex align-items-center border justify-content-center text-center">
                            <i class="bi bi-person-plus me-2"></i>
                            <span>Registrarse</span>
                        </a>
                    {% endif %}
                </div>
            </div>
        </nav>
    </header>

    <!-- Layout con sidebars -->
    <div class="container-fluid px-1 px-md-2">
        <div class="row justify-content-center">
            <main class="col-12 col-sm-11 col-md-10 col-lg-9 col-xl-8 px-0 px-md-2 d-flex flex-column align-items-center justify-content-start">
                {% block content %}{% endblock %}
            </main>
        </div>
    </div>
</body>
<!-- Bootstrap JS Bundle (incluye Popper) -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
</html>
